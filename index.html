<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BOLSA GLAUMIMOS ‚Äî Personalizados Deluxe</title>
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --pink: #ff8ac9;
    --soft-pink: #ffd6ea;
    --mint: #9df3c4;
    --mint-2: #86e6b6;
    --bg: #fff0f7;
    --card: #fff6fb;
    --accent: #ff69b4;
    --shadow-lg: 0 18px 60px rgba(169,78,143,0.15);
  }
  
  body {
    margin: 0; font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #ffb6d9 0%, #ffc9e3 25%, #b3e5fc 75%, #81d4fa 100%);
    color: #222; -webkit-font-smoothing: antialiased;
    min-height: 100vh;
  }

  /* HEADER */
  header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 15px 5%; position: sticky; top: 0; z-index: 100;
    background: #fff; box-shadow: 0 2px 15px rgba(0,0,0,0.05);
  }
  .brand { display: flex; gap: 12px; align-items: center; }
  .logo {
    width: 45px; height: 45px; background: var(--pink); border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-weight: 800; color: #fff; font-size: 24px;
  }



  /* Star glow: drop-shadow + subtle pulse on hover */
  .btn-stars .star-1 svg, .btn-stars .star-2 svg, .btn-stars .star-3 svg, .btn-stars .star-4 svg, .btn-stars .star-5 svg, .btn-stars .star-6 svg {
    filter: drop-shadow(0 0 6px rgba(255,215,0,0.9));
    transition: filter 200ms ease, transform 200ms ease;
    transform-origin: center;
  }

  @keyframes starGlow {
    0% { filter: drop-shadow(0 0 6px rgba(255,215,0,0.85)); transform: scale(1); }
    50% { filter: drop-shadow(0 0 14px rgba(255,215,0,1)); transform: scale(1.08); }
    100% { filter: drop-shadow(0 0 6px rgba(255,215,0,0.85)); transform: scale(1); }
  }

  .btn-stars:hover .star-1 svg,
  .btn-stars:hover .star-2 svg,
  .btn-stars:hover .star-3 svg,
  .btn-stars:hover .star-4 svg,
  .btn-stars:hover .star-5 svg,
  .btn-stars:hover .star-6 svg {
    animation: starGlow 1.2s ease-in-out infinite;
  }

  /* confirmed state for checkout */
  .btn-stars.confirmed { background: linear-gradient(135deg,#28c76f 0%, #1fa65a 100%) !important; box-shadow: 0 18px 40px rgba(34,197,94,0.12) !important; transform: translateY(0) scale(0.995); }
  .btn-stars.confirmed span { color: #fff; font-weight: 900; }
  .btn-stars.confirmed .star-1, .btn-stars.confirmed .star-2, .btn-stars.confirmed .star-3, .btn-stars.confirmed .star-4, .btn-stars.confirmed .star-5, .btn-stars.confirmed .star-6 { opacity: 0; transform: translateY(-8px) scale(0.6); }

  /* Sidebar-specific sizing: make checkout button full width and prominent */
  #sidebarCart .btn-stars { display:flex; width:100%; padding:14px 20px !important; font-size:16px !important; border-radius:14px; justify-content:center; align-items:center; gap:10px; box-shadow: 0 18px 40px rgba(105,212,255,0.08); }
  #sidebarCart .btn-stars .star-1, #sidebarCart .btn-stars .star-2, #sidebarCart .btn-stars .star-3, #sidebarCart .btn-stars .star-4, #sidebarCart .btn-stars .star-5, #sidebarCart .btn-stars .star-6 { opacity: 1; }
  /* Reserve space at bottom and pin checkout button */
  #sidebarCart .checkout-wrap { position: absolute; left: 30px; right: 30px; bottom: 24px; }
  #sidebarCart .checkout-wrap .btn-stars { width: 100%; }
  
  /* Remove o padding-bottom excessivo - agora o sidebar √© flex e adapta melhor */

  /* Basic press animations for buttons */
  .btn { transition: transform 140ms cubic-bezier(.2,.8,.2,1), box-shadow 140ms ease; }
  .btn:hover { transform: translateY(-2px); }
  .btn:active, .btn.pressed { transform: translateY(1px) scale(0.995); box-shadow: 0 10px 24px rgba(0,0,0,0.08); }

  .qty-btn { transition: transform 120ms ease; }
  .qty-btn:active, .qty-btn.pressed { transform: scale(0.92); }

  .section-btn, .filter-pill { transition: transform 120ms ease, box-shadow 120ms ease; }
  .section-btn:active, .filter-pill:active, .section-btn.pressed, .filter-pill.pressed { transform: translateY(2px) scale(0.995); box-shadow: 0 8px 20px rgba(0,0,0,0.06); }

  /* QUANTITY CONTROL (PROFESSIONAL) */
  .qty-control { display: inline-flex; align-items: center; gap: 8px; background: #fff; border-radius: 12px; padding: 4px; border: 1px solid #eee; }
  .qty-btn { background: transparent; border: none; color: var(--accent); width: 36px; height: 36px; display:flex; align-items:center; justify-content:center; font-size:18px; cursor: pointer; }
  .qty-btn:focus { outline: 2px solid rgba(133,200,255,0.4); outline-offset: 2px; }
  .qty-count { min-width: 48px; text-align: center; font-weight: 800; }
  .numeric-input { display:inline-flex; align-items:center; gap:8px; background:#fff; border-radius:12px; padding:6px; border:1px solid #eee; }
  .numeric-input input[type=number] { width:72px; padding:8px; border-radius:8px; border:1px solid #eee; font-weight:800; text-align:center; }
  .qty-subtotal { font-weight: 800; color: var(--accent); margin-left: 8px; }
  .qty-subtotal { font-weight: 800; color: var(--accent); margin-left: 8px; }

  /* MODAL */
  #detailModal { 
    position: fixed; inset: 0; background: rgba(0,0,0,0.6); 
    display: none; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(8px);
  }
  #detailModal.open { display: flex; }
  .detail-card { background: #fff; width: 95%; max-width: 1100px; border-radius: 25px; display: flex; overflow: hidden; max-height: 90vh; }
  .detail-img-area { flex: 1.1; background: #fdfdfd; padding: 40px; display: flex; flex-direction: column; align-items: center; justify-content: center; border-right: 1px solid #eee; }
  .detail-img-area img { width: 100%; max-width: 520px; border-radius: 20px; transition: 0.4s; border: 10px solid transparent; }
  .detail-info { flex: 1.4; padding: 28px; overflow-y: auto; display: flex; flex-direction: column; gap: 16px; padding-bottom: 140px; }
  .detail-footer { position: sticky; bottom: 0; display:flex; gap:12px; align-items:center; justify-content:space-between; padding:12px 0 0 0; background: linear-gradient(180deg, rgba(255,255,255,0), #fff 40%); border-top:1px solid #eee; }
  .detail-footer .left { flex:1; }
  .detail-footer .right { width: 260px; }
  @media (max-width:900px){ .detail-footer .right { width: 100%; } .detail-footer { flex-direction:column-reverse; align-items:stretch; gap:8px; } }

  /* SWATCHES */
  .swatches { display: flex; gap: 12px; flex-wrap: wrap; }
  .swatch { width: 38px; height: 38px; border-radius: 50%; cursor: pointer; border: 3px solid #fff; box-shadow: 0 0 0 1px #ddd; }
  .swatch.active { transform: scale(1.15); box-shadow: 0 0 0 2px var(--accent); }

  /* Uiverse-inspired glossy radio style adapted for .swatch */
  .swatch {
    -webkit-appearance: none;
    display: inline-block;
    margin: 6px;
    width: 38px; height: 38px;
    border-radius: 50%;
    cursor: pointer;
    vertical-align: middle;
    box-shadow: hsla(0,0%,100%,.15) 0 1px 1px, inset hsla(0,0%,0%,.35) 0 0 0 1px;
    background-color: transparent;
    background-image: -webkit-radial-gradient(rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 15%, rgba(255,255,255,0.3) 28%, rgba(255,255,255,0) 70%);
    background-repeat: no-repeat;
    -webkit-transition: background-position .15s cubic-bezier(.8,0,1,1), -webkit-transform .25s cubic-bezier(.8,0,1,1);
    transition: background-position .15s cubic-bezier(.8,0,1,1), transform .25s cubic-bezier(.8,0,1,1);
    border: 3px solid rgba(255,255,255,0.6);
  }

  .swatch.active {
    -webkit-transition: background-position .2s .15s cubic-bezier(0,0,.2,1), -webkit-transform .25s cubic-bezier(0,0,.2,1);
    transition: background-position .2s .15s cubic-bezier(0,0,.2,1), transform .25s cubic-bezier(0,0,.2,1);
    transform: scale(1.18);
    box-shadow: 0 0 0 2px var(--accent);
    border-color: var(--accent);
  }

  .swatch:active {
    -webkit-transform: scale(1.4);
    transform: scale(1.4);
    -webkit-transition: -webkit-transform .1s cubic-bezier(0,0,.2,1);
    transition: transform .1s cubic-bezier(0,0,.2,1);
  }
  

  /* CARRINHO SIDEBAR */
  #sidebarCart {
    position: fixed; right: -420px; top: 0; width: 420px; height: 100vh;
    background: #fff; z-index: 1100; transition: right 0.38s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.2s ease, opacity 0.2s ease;
    box-shadow: -8px 0 30px rgba(0,0,0,0.12); padding: 18px; display: flex; flex-direction: column;
    overflow: hidden; font-family: 'Poppins', sans-serif;
  }
  /* when closed, keep it fully hidden (no shadow) to avoid visible edge */
  #sidebarCart:not(.open) { right: -420px; box-shadow: none; visibility: hidden; opacity: 0; }
  #sidebarCart.open { right: 0; visibility: visible; opacity: 1; }
  
  #sidebarCart #cartList { flex: 1; overflow-y: auto; padding-right: 6px; margin-bottom: 12px; }
  #sidebarCart #cartList::-webkit-scrollbar { width: 5px; }
  #sidebarCart #cartList::-webkit-scrollbar-track { background: transparent; }
  #sidebarCart #cartList::-webkit-scrollbar-thumb { background: #ddd; border-radius: 3px; }
  #sidebarCart #cartList::-webkit-scrollbar-thumb:hover { background: #bbb; }
  
  .cart-item { display: flex; gap: 12px; margin-bottom: 14px; align-items: flex-start; padding-bottom: 14px; border-bottom: 1px solid #f0f0f0; font-size: 13px; }
  .cart-item img { width: 64px; height: 64px; border-radius: 10px; object-fit: cover; flex-shrink: 0; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  .cart-item > div:nth-child(2) { flex: 1; }
  
  .btn-clear, .btn-support {
    padding: 10px 12px; background: #f5f5f5;
    border: 1px solid #e0e0e0; border-radius: 8px; cursor: pointer; font-size: 13px;
    font-weight: 600; transition: all 140ms ease; color: #333;
  }
  
  .btn-clear:hover, .btn-support:hover { background: #efefef; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
  .btn-clear:active, .btn-support:active { transform: translateY(0px); box-shadow: 0 2px 6px rgba(0,0,0,0.06); }
  #sidebarCart #cartList::-webkit-scrollbar { width: 6px; }
  #sidebarCart #cartList::-webkit-scrollbar-track { background: transparent; }
  #sidebarCart #cartList::-webkit-scrollbar-thumb { background: #ccc; border-radius: 3px; }
  
  .cart-item { display: flex; gap: 15px; margin-bottom: 15px; align-items: flex-start; padding-bottom: 15px; border-bottom: 1px solid #f5f5f5; }
  .cart-item img { width: 70px; height: 70px; border-radius: 12px; object-fit: cover; flex-shrink: 0; }
  .cart-item > div:nth-child(2) { flex: 1; }
  
  .btn-clear, .btn-support {
    padding: 10px 12px; background: rgba(200,200,200,0.2);
    border: 1px solid #ddd; border-radius: 8px; cursor: pointer; font-size: 13px;
    font-weight: 600; transition: all 140ms ease; color: #333;
  }
  
  .btn-clear:hover, .btn-support:hover { background: rgba(200,200,200,0.4); transform: translateY(-1px); }

  #carrinhoFlutuante {
    position: fixed; bottom: 30px; right: 30px; width: 75px; height: 75px;
    background: var(--accent); color: #fff; border-radius: 50%; 
    display: flex; align-items: center; justify-content: center; font-size: 32px;
    cursor: pointer; box-shadow: 0 12px 30px rgba(255,105,180,0.4); z-index: 999;
  }
  .badge { position: absolute; top: 0; right: 0; background: #fff; color: var(--accent); width: 25px; height: 25px; border-radius: 50%; font-size: 13px; font-weight: 800; display: flex; align-items: center; justify-content: center; border: 2px solid var(--accent); }

  /* FABRIC PREVIEW */
  #fabricPreview {
    width: 60px; height: 60px; border-radius: 12px; border: 2px solid #eee;
    background: #f9f9f9; cursor: pointer; display: flex; align-items: center; justify-content: center;
    font-size: 28px; transition: transform 140ms ease, box-shadow 140ms ease; overflow: hidden;
  }
  #fabricPreview:hover { transform: scale(1.08); box-shadow: 0 4px 16px rgba(0,0,0,0.12); }
  #fabricPreview:active { transform: scale(0.92); }
  #fabricPreview svg { width: 100%; height: 100%; }
  #fabricPreview img { width: 100%; height: 100%; object-fit: cover; }

  /* FABRIC LIGHTBOX */
  #fabricLightbox {
    position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 2000;
    display: none; align-items: center; justify-content: center; backdrop-filter: blur(6px);
  }
  #fabricLightbox.open { display: flex; }
  .fabric-lightbox-content {
    position: relative; background: #fff; border-radius: 20px; padding: 20px;
    max-width: 90vw; max-height: 90vh; display: flex; flex-direction: column; align-items: center;
    box-shadow: 0 25px 60px rgba(0,0,0,0.3); animation: fabricFlyIn 0.5s cubic-bezier(0.2,0.8,0.2,1) forwards;
  }
  @keyframes fabricFlyIn {
    0% { opacity: 0; transform: translate(100vw, -100vh) scale(0.3); }
    100% { opacity: 1; transform: translate(0, 0) scale(1); }
  }
  .fabric-lightbox-close {
    position: absolute; top: 12px; right: 12px; background: #f0f0f0; border: none;
    width: 32px; height: 32px; border-radius: 50%; cursor: pointer; font-size: 20px;
    display: flex; align-items: center; justify-content: center; transition: background 140ms ease;
  }
  .fabric-lightbox-close:hover { background: #e0e0e0; }
  .fabric-lightbox-img {
    max-width: 500px; max-height: 500px; border-radius: 16px; object-fit: contain;
    margin: 10px 0;
  }
  .fabric-lightbox-title {
    font-weight: 700; font-size: 16px; color: #333; text-align: center; margin-top: 10px;
  }

  /* TOP FILTERS */
  .top-filters {
    display: flex; gap: 12px; padding: 20px 5%; align-items: center;
    background: rgba(255,255,255,0.3); backdrop-filter: blur(10px);
    overflow-x: auto; scrollbar-width: thin;
  }
  
  /* MAIN LAYOUT */
  .main {
    display: flex; gap: 20px; padding: 30px 5%; align-items: flex-start; max-width: 2000px; margin: 0 auto;
  }
  
  .col-sections {
    width: 180px; flex-shrink: 0;
  }
  
  .section-nav {
    display: flex; flex-direction: column; gap: 8px;
  }
  
  .col-products {
    flex: 1; min-width: 0;
  }
  
  .col-right {
    width: 240px; flex-shrink: 0;
  }
  
  /* SECTION BUTTONS */
  .section-btn {
    background: rgba(255,255,255,0.6); border: 1px solid rgba(255,255,255,0.4);
    padding: 10px 15px; border-radius: 12px; cursor: pointer; font-weight: 600;
    color: #5a3b4f; font-size: 13px; transition: all 140ms ease;
  }
  
  .section-btn:hover {
    background: rgba(255,255,255,0.8); box-shadow: 0 6px 20px rgba(0,0,0,0.08);
  }
  
  .section-btn.active {
    background: linear-gradient(135deg, #ff8ac9 0%, #ff69b4 100%);
    color: #fff; box-shadow: 0 12px 30px rgba(255,105,180,0.25);
  }
  
  /* FILTER PILLS */
  .filter-pill {
    background: rgba(255,255,255,0.5); border: 1px solid rgba(255,255,255,0.3);
    padding: 8px 16px; border-radius: 20px; cursor: pointer; font-weight: 600;
    color: #5a3b4f; font-size: 13px; transition: all 140ms ease; white-space: nowrap;
  }
  
  .filter-pill:hover {
    background: rgba(255,255,255,0.7); transform: translateY(-2px);
  }
  
  .filter-pill.active {
    background: linear-gradient(135deg, #c5b6ff 0%, #ff8ac9 100%);
    color: #fff; box-shadow: 0 8px 24px rgba(197,182,255,0.3);
  }
  
  /* GRID & CARDS */
  .grid {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px; animation: gridAppear 0.4s ease;
  }
  
  @keyframes gridAppear {
    from { opacity: 0; } to { opacity: 1; }
  }
  
  .card {
    background: #fff; border-radius: 16px; padding: 16px; overflow: hidden;
    box-shadow: 0 6px 24px rgba(0,0,0,0.08); cursor: pointer; transition: all 200ms cubic-bezier(0.2,0.8,0.2,1);
    position: relative; display: flex; flex-direction: column; gap: 10px;
    animation: cardFloat 0.5s ease backwards;
  }
  
  @keyframes cardFloat {
    from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); }
  }
  
  .card:hover {
    transform: translateY(-8px); box-shadow: 0 16px 48px rgba(0,0,0,0.12);
  }
  
  .card .img {
    width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 12px;
    transition: transform 200ms ease; background: #f5f5f5;
  }
  
  .card:hover .img { transform: scale(1.05); }
  
  .badge-tag {
    position: absolute; top: 12px; right: 12px; background: linear-gradient(135deg, #ff8ac9, #ff69b4);
    color: #fff; padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 800;
    box-shadow: 0 4px 16px rgba(255,105,180,0.3); z-index: 10;
  }
  
  .fav-btn {
    position: absolute; top: 12px; left: 12px; background: rgba(255,255,255,0.8);
    border: none; width: 36px; height: 36px; border-radius: 50%; cursor: pointer;
    display: flex; align-items: center; justify-content: center; font-size: 18px;
    transition: all 140ms ease; z-index: 11;
  }
  
  .fav-btn:hover { background: #fff; transform: scale(1.1); }
  .fav-btn.active { color: #ff69b4; }
  
  .price {
    font-size: 18px; font-weight: 800; color: var(--accent); line-height: 1.2;
  }
  
  .card .btn-add, .card .btn-detail {
    padding: 10px; border: none; border-radius: 10px; cursor: pointer;
    font-weight: 700; font-size: 12px; transition: all 140ms ease;
  }
  
  .card .btn-add {
    background: linear-gradient(135deg, #ff8ac9 0%, #ff69b4 100%);
    color: #fff; box-shadow: 0 8px 20px rgba(255,105,180,0.2);
  }
  
  .card .btn-add:hover { transform: translateY(-2px); box-shadow: 0 12px 28px rgba(255,105,180,0.3); }
  
  .card .btn-detail {
    background: transparent; border: 1px solid var(--accent); color: var(--accent);
  }
  
  .card .btn-detail:hover { background: rgba(255,105,180,0.1); }
  
  /* SEARCH BAR */
  .search-container {
    margin-bottom: 20px;
  }
  
  .search {
    width: 100%; padding: 12px 16px; border: 1px solid #ddd;
    border-radius: 14px; font-family: 'Poppins', sans-serif; font-size: 14px;
    background: #fff; transition: all 200ms ease;
  }
  
  .search:focus {
    outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(255,105,180,0.1);
  }
  
  /* RIGHT SIDEBAR / PREFERENCES CARD */
  .card[style*="dashed"] {
    background: linear-gradient(135deg, rgba(255,255,255,0.8), rgba(255,255,255,0.6));
    border: 2px dashed var(--pink); padding: 20px;
  }
  
  .btn {
    padding: 12px 18px; border: none; border-radius: 12px; cursor: pointer;
    font-weight: 700; font-size: 14px; background: linear-gradient(135deg, #ff8ac9, #ff69b4);
    color: #fff; transition: all 140ms cubic-bezier(0.2, 0.8, 0.2, 1);
    box-shadow: 0 10px 24px rgba(255,105,180,0.2);
  }
  
  .btn:hover { transform: translateY(-3px); box-shadow: 0 14px 32px rgba(255,105,180,0.3); }
  
  .btn-add {
    background: linear-gradient(135deg, #ff8ac9 0%, #ff69b4 100%);
  }
  
  .btn-stars {
    display: flex; align-items: center; gap: 8px; justify-content: center;
    position: relative; overflow: visible;
  }
  
  .btn-stars span {
    z-index: 2; position: relative; color: #fff; font-weight: 700;
  }
  
  .btn-stars .star-1, .btn-stars .star-2, .btn-stars .star-3, .btn-stars .star-4, .btn-stars .star-5, .btn-stars .star-6 {
    position: absolute; opacity: 0.6; pointer-events: none;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  /* Posicionar stars ao redor do bot√£o em hover */
  .btn-stars:hover .star-1 { transform: translate(60px, -60px) scale(1.2); opacity: 1; }
  .btn-stars:hover .star-2 { transform: translate(80px, 0px) scale(1.1); opacity: 1; }
  .btn-stars:hover .star-3 { transform: translate(60px, 60px) scale(1); opacity: 0.9; }
  .btn-stars:hover .star-4 { transform: translate(-60px, 60px) scale(1); opacity: 0.9; }
  .btn-stars:hover .star-5 { transform: translate(-80px, 0px) scale(1.1); opacity: 1; }
  .btn-stars:hover .star-6 { transform: translate(-60px, -60px) scale(1.2); opacity: 1; }
  
  .btn-stars .star-1 svg, .btn-stars .star-2 svg, .btn-stars .star-3 svg, .btn-stars .star-4 svg, .btn-stars .star-5 svg, .btn-stars .star-6 svg {
    fill: #ffd700; filter: drop-shadow(0 0 6px rgba(255,215,0,0.9));
    transition: filter 200ms ease, transform 200ms ease;
    transform-origin: center;
  }
  
  .btn-clear, .btn-support {
    padding: 10px; margin: 0; background: rgba(200,200,200,0.2);
    border: 1px solid #ddd; border-radius: 8px; cursor: pointer; font-size: 18px;
    transition: all 140ms ease;
  }
  
  .btn-clear:hover, .btn-support:hover { background: rgba(200,200,200,0.4); transform: scale(1.05); }

  @media (max-width: 900px) {
    .main { flex-direction: column; }
    .col-sections { width: 100%; overflow-x: auto; }
    .section-nav { flex-direction: row; position: static; }
    .col-right { display: none; }
    .detail-card { flex-direction: column; width: 100%; height: 100%; border-radius: 0; }
    #sidebarCart { width: 100%; }
  }
  /* Mobile-specific responsive improvements (<=600px) */
  @media (max-width: 600px) {
    .grid { grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .card { border-radius: 12px; padding: 14px; }
    header { padding: 12px 4%; }
    .logo { width: 40px; height: 40px; font-size: 20px; }
    .search { padding: 12px; font-size: 15px; }
    .btn { padding: 14px 16px; font-size: 16px; border-radius: 12px; }
    .btn-stars { padding: 12px 14px; font-size: 15px; }
    .qty-btn { width: 44px; height: 44px; }
    .numeric-input input[type=number] { width: 84px; padding:10px; font-size:16px; }
    /* Sidebar becomes bottom sheet */
    #sidebarCart {
      position: fixed; left: 0; right: 0; width: 100%; height: auto; top: auto; bottom: 0;
      transform: translateY(110%);
      transition: transform 0.36s cubic-bezier(0.2,0.8,0.2,1), box-shadow 220ms ease;
      border-radius: 12px 12px 0 0; padding-bottom: 140px; max-height: 90vh; overflow: hidden; box-shadow: 0 -12px 40px rgba(0,0,0,0.12);
      z-index: 1400;
    }
    /* closed state: fully translated down and non-interactive */
    #sidebarCart:not(.open) { transform: translateY(110%); pointer-events: none; }
    /* open state: visible and interactive */
    #sidebarCart.open { transform: translateY(0); pointer-events: auto; }
    #sidebarCart #cartList { max-height: 50vh; overflow-y: auto; }
    /* Pin checkout button inside sheet: use sticky footer area */
    #sidebarCart .checkout-wrap { position: sticky; bottom: 12px; left: 16px; right: 16px; padding-bottom: 6px; background: linear-gradient(180deg, rgba(255,255,255,0), rgba(255,255,255,0.0)); }
    #sidebarCart .btn-stars { padding: 14px 18px; font-size: 16px; border-radius: 12px; }
    /* Floating cart higher (above sheet) */
    #carrinhoFlutuante { bottom: 110px; right: 18px; width: 64px; height: 64px; font-size: 28px; }
    /* Modal and lightbox adaptations */
    /* Modal: make content scrollable and pin footer */
    .detail-card { border-radius: 12px; max-height: 85vh; display: flex; flex-direction: column; }
    #detailModal .detail-card { width: 100%; height: auto; border-radius: 12px; margin: 0 6px; }
    .detail-img-area { padding: 16px; }
    .detail-img-area img { max-width: 100%; height: auto; border-radius: 12px; border-width: 6px; }
    .detail-info { padding: 16px; flex: 1 1 auto; overflow-y: auto; padding-bottom: 140px; }
    /* When modal is open, pin footer to viewport bottom so Add stays fixed */
    #detailModal.open .detail-footer { position: fixed; left: 50%; transform: translateX(-50%); bottom: 14px; width: calc(100% - 28px); max-width: 1100px; z-index: 1601; border-radius: 12px; padding: 12px 18px; box-shadow: 0 10px 30px rgba(0,0,0,0.12); }
    #detailModal.open .detail-info { padding-bottom: 90px; }
    .fabric-lightbox-content { width: 95vw; max-height: 80vh; }
  }
</style>
</head>
<body>
  

<header>
  <div class="brand">
    <div class="logo">G</div>
    <div>
      <div style="font-weight:800; line-height:1; font-size:18px">GLAUMIMOS</div>
      <small style="color: #888">Bolsas e variedades</small>
    </div>
  </div>
  <div style="font-weight: 600; color: var(--accent); font-size: 14px; cursor: pointer" onclick="toggleCart()">
    MEU CARRINHO (<span id="countBadgeText">0</span>)
  </div>
</header>

<div class="top-filters">
    <button class="filter-pill active" id="tag-all" onclick="filterByTag('all')">Todos</button>
    <button class="filter-pill" id="tag-promo" onclick="filterByTag('promo')">üî• Promo√ß√µes</button>
    <button class="filter-pill" id="tag-best" onclick="filterByTag('best')">üèÜ Mais Vendidos</button>
    <button class="filter-pill" id="tag-fav" onclick="filterByTag('fav')">‚≠ê Favoritos</button>
</div>

<div class="main">
  <div class="col-sections">
    <div class="section-nav">
      <h4 style="margin: 0 0 10px 15px; color: #fff; font-size: 12px; text-transform: uppercase;">Categorias</h4>
      <button class="section-btn active" id="sec-todos" onclick="filterByCategory('todos')">üõçÔ∏è Ver Tudo</button>
      <button class="section-btn" id="sec-bolsas" onclick="filterByCategory('bolsas')">üëú Bolsas</button>
      <button class="section-btn" id="sec-kits" onclick="filterByCategory('kits')">üéÅ Kits Venha Ver</button>
      <button class="section-btn" id="sec-copos" onclick="filterByCategory('copos')">ü•§ Copos & Canecas</button>
      <button class="section-btn" id="sec-toalhas" onclick="filterByCategory('toalhas')">üßµ Toalhas</button>
    </div>
  </div>

  <div class="col-products">
    <div class="search-container">
      <input type="text" class="search" id="searchInput" placeholder="Pesquisar em Bolsas Glaumimos..." oninput="renderProducts()">
    </div>
    <div style="background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 25px; box-shadow: 0 10px 40px rgba(0,0,0,0.1)">
      <div id="gridProdutos" class="grid"></div>
    </div>
  </div>

  <div class="col-right">
    <div class="card" style="text-align: left; background: var(--card); border-style: dashed;">
      <h3 style="margin-top:0">‚ú® Prefer√™ncias</h3>
      <p style="font-size: 12px; color: #777">Aplique uma cor e tecido padr√£o para agilizar seus pedidos.</p>
      
      <label style="font-weight:700; display:block; margin-bottom:5px; font-size: 13px;">Cor Padr√£o</label>
      <div class="swatches" id="globalSwatches"></div>
      
      <label style="font-weight:700; display:block; margin: 15px 0 5px; font-size: 13px;">Tecido Padr√£o</label>
      <select id="globalTecido" class="search" style="padding: 10px; font-size: 14px">
        <option value="">Nenhum selecionado</option>
        <option value="Plush">Plush (Fofinho)</option>
        <option value="Couro Sint√©tico">Couro Sint√©tico</option>
        <option value="Neoprene">Neoprene</option>
      </select>

      <div style="margin-top:12px; display:flex; align-items:center; gap:8px">
        <label style="display:flex; align-items:center; gap:8px; font-weight:700">
          <input type="checkbox" id="soundToggle"> Ativar sons
        </label>
      </div>

      <button class="btn btn-add" style="margin-top:12px" onclick="applyGlobalSettings()">Salvar Ajustes</button>
    </div>
  </div>
</div>

<div id="detailModal">
  <div class="detail-card">
    <div class="detail-img-area">
      <img id="detailImg" src="" alt="Produto" loading="lazy">
      <div style="margin-top:20px; font-weight:700; color:var(--accent); text-align: center" id="colorNameDisplay">Escolha uma cor</div>
    </div>
    <div class="detail-info">
      <div style="display:flex; justify-content:space-between; align-items:start">
        <div>
          <h2 id="detailTitle" style="margin:0; font-size: 24px">Nome do Produto</h2>
          <div class="price" id="detailPrice">R$ 0,00</div>
        </div>
        <button onclick="closeDetail()" style="background:#f0f0f0; border:none; width:35px; height:35px; border-radius:50%; cursor:pointer; font-weight: 800">√ó</button>
      </div>

      <div>
        <label style="font-weight:700; font-size: 14px">üé® Escolha a Cor:</label>
        <div class="swatches" id="detailSwatches" style="margin-top:10px"></div>
      </div>

      <div>
        <label style="font-weight:700; font-size: 14px">üßµ Tecido/Material:</label>
        <div style="display: flex; align-items: center; gap: 10px; margin-top: 5px">
          <select id="detailFabric" class="search" style="padding:10px; flex: 1"></select>
          <span id="alklearPrice" style="color: #32cd32; font-weight: 700; font-size: 14px; display: none">+R$ 2,00</span>
          <span id="pompomPrice" style="color: #32cd32; font-weight: 700; font-size: 14px; display: none">+R$ 2,00</span>
          <div id="fabricPreview" title="Clique para ampliar o tecido"></div>
        </div>
      </div>
      <div style="margin-top:10px; display:flex; align-items:center; gap:8px">
        <label style="display:flex; align-items:center; gap:8px; font-weight:700">
          <input type="checkbox" id="detailPompom"> Adicionar pompom (+R$ 2,00 por und)
        </label>
      </div>
            <div>
        <label style="font-weight:700; font-size: 14px">üìè Tamanho:</label>
        <select id="detailSize" class="search" style="margin-top:5px; padding:10px"></select>
      </div>
      <div style="margin-top:10px">
        <label style="font-weight:700; font-size: 14px">üë§ Nome do Cliente:</label>
        <input id="detailClientName" type="text" class="search" placeholder="Nome completo" style="margin-top:6px; padding:8px;">
      </div>
      <div style="display:flex; align-items:center; gap:15px; margin-top:15px; padding-top: 20px; border-top: 1px solid #eee">
        <div class="numeric-input" style="background:#f8f8f8; border-radius:12px; padding:6px 8px;">
          <button id="detailQtyMinus" class="qty-btn" aria-label="Diminuir quantidade" title="Diminuir">‚àí</button>
          <input id="detailQtyInput" type="number" min="1" value="1" class="qty-count" style="width:72px; padding:6px;">
          <button id="detailQtyPlus" class="qty-btn" aria-label="Aumentar quantidade" title="Aumentar">+</button>
        </div>
        <div id="detailQtyDisplay" style="font-weight:700; margin-left:8px">Qtd: 1</div>
        <div style="display:flex; flex-direction:column; gap:6px; margin-left:8px; align-items:flex-start">
          <div style="font-size:12px; color:#7a4960">M√≠nimo total: <strong>20</strong> bolsas ‚Ä¢ M√≠nimo por cor: <strong>10</strong></div>
            <div style="display:flex; gap:8px; align-items:center">
              <button id="checkAllocationBtn" class="btn" style="padding:6px 10px; font-size:12px" onclick="checkAllocation()">Verificar aloca√ß√£o</button>
              <label style="font-size:13px; display:flex; align-items:center; gap:6px"><input type="checkbox" id="customDistrib"> Distribui√ß√£o personalizada</label>
            </div>
          <div id="allocationInfo" style="font-size:12px; color:#9a5a7a"></div>
            <div id="allocationInputs" style="margin-top:8px"></div>
        </div>
      </div>

      <div class="detail-footer">
        <div class="left">
          <div style="font-size:13px; color:#5a3b4f">Finalize sua sele√ß√£o e adicione ao carrinho.</div>
        </div>
        <div class="right">
          <button id="addFromModalBtn" class="btn btn-add btn-stars" style="width:100%" onclick="addItemFromModal()">
            <span>Adicionar ao Carrinho</span>
            <div class="star-1"><svg width="28" height="28" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" class="fil0"/></svg></div>
            <div class="star-2"><svg width="20" height="20" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8" class="fil0"/></svg></div>
            <div class="star-3"><svg width="10" height="10" viewBox="0 0 24 24"><circle cx="12" cy="12" r="4" class="fil0"/></svg></div>
            <div class="star-4"><svg width="12" height="12" viewBox="0 0 24 24"><circle cx="12" cy="12" r="6" class="fil0"/></svg></div>
            <div class="star-5"><svg width="18" height="18" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" class="fil0"/></svg></div>
            <div class="star-6"><svg width="8" height="8" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3" class="fil0"/></svg></div>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="fabricLightbox">
  <div class="fabric-lightbox-content">
    <button class="fabric-lightbox-close" onclick="closeFabricLightbox()">√ó</button>
    <img id="fabricLightboxImg" class="fabric-lightbox-img" src="" alt="Tecido">
    <div class="fabric-lightbox-title" id="fabricLightboxTitle">Tecido</div>
  </div>
</div>

<div id="carrinhoFlutuante" onclick="toggleCart()">
  üõí <div class="badge" id="countBadge">0</div>
</div>

<div id="sidebarCart">
  <!-- HEADER -->
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 14px; border-bottom: 2px solid #f0f0f0">
    <h2 style="margin: 0; font-size: 20px; font-weight: 800; color: #333">üõçÔ∏è Seu Pedido</h2>
    <button onclick="toggleCart()" style="background: none; border: none; font-size: 28px; cursor: pointer; color: #999; padding: 0; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; transition: color 140ms">√ó</button>
  </div>

  <!-- ITEMS SCROLL AREA -->
  <div id="cartList" style="flex: 1; overflow-y: auto; margin-bottom: 16px; padding-right: 6px"></div>

  <!-- FORMUL√ÅRIO COMPACTO -->
  <div style="background: linear-gradient(135deg, #fff0f7 0%, #fff8fb 100%); padding: 14px; border-radius: 10px; margin-bottom: 14px; border: 1px solid #ffe6f0">
    <div style="display: flex; gap: 10px; align-items: flex-start">
      <div style="flex: 1">
        <label style="font-weight: 700; font-size: 11px; color: #666; display: block; margin-bottom: 4px; text-transform: uppercase">üìÖ Retirada</label>
        <input type="date" id="desiredDate" class="search" style="padding: 6px 8px; width: 100%; box-sizing: border-box; font-size: 12px; border: 1px solid #ddd; border-radius: 6px">
      </div>
      <div style="flex: 1">
        <label style="font-weight: 700; font-size: 11px; color: #666; display: block; margin-bottom: 4px; text-transform: uppercase">üìù Obs.</label>
        <input type="text" id="generalTheme" class="search" placeholder="Presente?" style="padding: 6px 8px; width: 100%; box-sizing: border-box; font-size: 12px; border: 1px solid #ddd; border-radius: 6px">
      </div>
    </div>
  </div>

  <!-- TOTAL -->
  <div style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 16px; padding: 12px 0; border-top: 2px solid #f0f0f0; border-bottom: 2px solid #f0f0f0">
    <span style="font-weight: 600; font-size: 14px; color: #666; text-transform: uppercase">Total</span>
    <span id="cartTotal" style="font-weight: 800; font-size: 20px; color: var(--accent)">R$ 0,00</span>
  </div>

  <!-- A√á√ïES SECUND√ÅRIAS -->
  <div style="display: flex; gap: 8px; margin-bottom: 12px">
    <button class="btn-clear" onclick="clearCart()" style="flex: 1; padding: 8px; font-size: 12px; font-weight: 600">üóëÔ∏è Limpar</button>
    <button class="btn-support" onclick="openSupport()" style="flex: 1; padding: 8px; font-size: 12px; font-weight: 600">üí¨ Chat</button>
  </div>

  <!-- CHECKOUT BUTTON (DESTAQUE PRINCIPAL) -->
  <button class="btn btn-add btn-stars" style="width: 100%; padding: 16px; font-size: 14px; font-weight: 700; margin: 0; flex-shrink: 0" onclick="checkout()">
    <span>FINALIZAR COMPRA</span>
    <div class="star-1"><svg width="20" height="20" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" class="fil0"/></svg></div>
    <div class="star-2"><svg width="16" height="16" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8" class="fil0"/></svg></div>
    <div class="star-3"><svg width="9" height="9" viewBox="0 0 24 24"><circle cx="12" cy="12" r="4" class="fil0"/></svg></div>
    <div class="star-4"><svg width="11" height="11" viewBox="0 0 24 24"><circle cx="12" cy="12" r="6" class="fil0"/></svg></div>
    <div class="star-5"><svg width="15" height="15" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" class="fil0"/></svg></div>
    <div class="star-6"><svg width="7" height="7" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3" class="fil0"/></svg></div>
  </button>
</div>


<script>
const PHONE_NUMBER = "5585986589114";
const COLORS_DB = {
  "#ffb6d9": "Rosa Beb√™", "#9df3c4": "Verde Menta", "#c5b6ff": "Lil√°s Candy",
  "#fce5b2": "Amarelo Vanilla", "#ff69b4": "Pink Deluxe","#008000": "Verde", "#ff0000": "Vermelho", "#89cff0": "Azul Beb√™",
};



const PRODUCTS = [
  // maletinha de m√£o
  {
    id: 1, category: 'bolsas', title: 'Maletinha de m√£o', price: 7, images: ['bolsa1.jpeg'],
    colors: ['#ffb6d9', '#c5b6ff'], fabrics: ['Pvc'], sizes: ['16x12','18x14','20x16','22x18','20x25'],
    sizePrices: { '16x12': 7, '18x14': 8, '20x16': 9.5, '22x18': 11, '20x25': 15 }, tag: 'best'
  },
  {
    id: 2, category: 'bolsas', title: 'Maletinha de m√£o em pl√°stico', price: 8.5, images: ['bolsa4.jpeg'],
    colors: ['#ffb6d9', '#c5b6ff'], fabrics: ['Cristal'], sizes: ['16x12','18x14','20x16','22x18','20x25'],
    sizePrices: { '16x12': 8.5, '18x14': 9.5, '20x16': 10.5, '22x18': 12.5, '20x25': 14.5 }, tag: ''
  },
  {
    id: 3, category: 'bolsas', title: 'Maletinha de m√£o de pl√°stico com bolso', price: 11, images: ['bolsa5.jpeg'],
    colors: ['#ffb6d9', '#c5b6ff'], fabrics: ['Cristal'], sizes: ['18x14','20x16','22x18','20x25'],
    sizePrices: {'18x14': 11, '20x16': 13, '22x18': 15, '20x25': 17 }, tag: ''
  },
  {
    id: 4, category: 'bolsas', title: 'Maletinha toda em pl√°stico e estampa central', price: 9, images: ['bolsa6.jpeg'],
    colors: ['#ffb6d9', '#c5b6ff'], fabrics: ['Cristal'], sizes: ['16x12','18x14','20x16','22x18','20x25'],
    sizePrices: { '16x12': 9, '18x14': 10, '20x16': 11, '22x18': 13, '20x25': 15 }, tag: ''
  },
  // estojo
  {
    id: 5, category: 'bolsas', title: 'Estojo', price: 7, images: ['bolsa2.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Pvc'], sizes: ['18x8', '20x10','22x12'],
    sizePrices: {'18x8': 7,'20x10': 8,'22x12': 9,}, tag: ''
  },
  {
    id: 6, category: 'bolsas', title: 'Estojo pl√°stico cristal ', price: 8.5, images: ['bolsa7.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Cristal'], sizes: ['18x8', '20x10','22x12'],
    sizePrices: {'18x8': 8.5,'20x10': 9.5,'22x12': 10.5,}, tag: ''
  },
  {
    id: 7, category: 'bolsas', title: 'Estojo pl√°stico cristal + hologr√°fico', price: 10, images: ['bolsa8.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Cristal'], sizes: ['18x8', '20x10','22x12'],
    sizePrices: {'18x8': 10,'20x10': 11,'22x12': 12,}, tag: ''
  },
  {
    id: 8, category: 'bolsas', title: 'Estojo ba√∫ em pl√°stico cristal', price: 8.5, images: ['bolsa9.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Cristal'], sizes: ['18x8', '20x10','22x12'],
    sizePrices: {'18x8': 8.5,'20x10': 9.5,'22x12': 10.5,}, tag: ''
  },
  {
    id: 9, category: 'bolsas', title: 'Estojo pl√°stico cristal abertura total', price: 9, images: ['bolsa15.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Cristal'], sizes: ['18x8', '20x10','22x12'],
    sizePrices: {'18x8': 9,'20x10': 10,'22x12': 11,}, tag: ''
  },
  //necesseire
  {
    id: 10, category: 'bolsas', title: 'Necesseire pl√°tico cristal', price: 10, images: ['bolsa10.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Cristal'], sizes: ['√önico 20x16'],
    sizePrices: {'20x16': 10}, tag: ''
  },
  {
    id: 11, category: 'bolsas', title: 'Necesseire estampa total', price: 6, images: ['bolsa11.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Estampado em pvc'], sizes: ['√önico 18x14'],
    sizePrices: {'18x14': 6}, tag: ''
  },
  {
    id: 12, category: 'bolsas', title: 'Porta moedas ou necesserie', price: 3, images: ['bolsa12.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Estampado em pvc'], sizes: ['Porta moedas 10x6','Necesserie 18x12'],
    sizePrices: {'Porta Moedas 10x6': 3,'Necesserie 18x12': 5}, tag: ''
  },
  {
    id: 46, category: 'bolsas', title: 'Porta moedas ou porta documentos ', price: 2, images: ['bolsa46.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Estampado em pvc'], sizes: ['Porta moedas 12x6','Porta documentos 16x8'],
    sizePrices: {'Porta Moedas 12x6': 2,'Porta documentos 16x8': 3}, tag: ''
  },
  {
    id: 47, category: 'bolsas', title: 'Porta celular com al√ßa de m√£o', price: 6, images: ['bolsa47.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Estampado em pvc'], sizes: ['20x10'],
    sizePrices: {'20x10': 3}, tag: ''
  },
  {
    id: 13, category: 'bolsas', title: 'Necesseire box estampa total', price: 5, images: ['bolsa13.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Estampado em pvc'], sizes: ['12x6','18x8'],
    sizePrices: {'12x6': 5,'18x8': 6.5}, tag: ''
  },
  {
    id: 14, category: 'bolsas', title: 'Necesseire estampa total', price: 11, images: ['bolsa14.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Estampado em pvc'], sizes: ['√önico 20x16x8'],
    sizePrices: {'20x16x8': 11}, tag: ''
  },
  {
    id: 15, category: 'bolsas', title: 'Bolsa de m√£o', price: 7, images: ['bolsa3.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Pvc'], sizes: ['√önico 15x15'],
    sizePrices: {'15x15': 7}, tag: ''
  },
  {
    id: 45, category: 'bolsas', title: 'Necesseire em pl√°stico cristal em und', price: 35, images: ['bolsa45.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Pvc'], sizes: ['√önico 15x15'],
    sizePrices: {'15x15': 7}, tag: ''
  },
  //bolsas transversais
  {
    id: 16, category: 'bolsas', title: 'Mala com al√ßa de m√£o e transversal', price: 18, images: ['bolsa 16.jpeg'],
    colors: ['#ffb6d9', '#c5b6ff'], fabrics: ['Pvc'], sizes: ['20x16'],
    sizePrices: { '20x16': 18}, tag: ''
  },
  {
    id: 17, category: 'bolsas', title: 'Bolsa  transversal em pl√°stico cristal mais hologr√°fico e lantejoulas', price: 17, images: ['bolsa17.jpeg'],
    colors: ['#ffb6d9', '#c5b6ff'], fabrics: ['Hologr√°fico e plastico cristal'], sizes: ['20 de comprimento, lateral 16x12'],
    sizePrices: { '20 de comprimento, lateral 16x12': 17}, tag: ''
  },
  {
    id: 18, category: 'bolsas', title: 'transversal 3D em pl√°stico cristal mais frente em hologr√°fico', price: 17, images: ['bolsa18.jpeg'],
    colors: ['#ffb6d9', '#c5b6ff'], fabrics: ['Hologr√°fico e plastico cristal'], sizes: ['20x16'],
    sizePrices: {'20x16': 17}, tag: ''
  },
  {
    id: 19, category: 'bolsas', title: 'Bolsa  transversal 3D', price: 15, images: ['bolsa19.jpeg'],
    colors: ['#ffb6d9', '#c5b6ff'], fabrics: ['Pvc'], sizes: ['20x16'],
    sizePrices: { '20x16': 15}, tag: ''
  },
  {
    id: 20, category: 'bolsas', title: 'Bolsa cilindro', price: 15, images: ['bolsa20.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Pvc'], sizes: ['20 de comprimento, lateral 15'],
    sizePrices: {'20 de comprimento, lateral 15': 15}, tag: ''
  },
  {
    id: 21, category: 'bolsas', title: 'Lancheirinha transversal ', price: 14, images: ['bolsa21.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Pvc'], sizes: ['20x16'],
    sizePrices: {'20x16': 14}, tag: ''
  },
  {
    id: 22, category: 'bolsas', title: 'Mini mala viagem', price: 18, images: ['bolsa22.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Estampado em pvc'], sizes: ['28x16'],
    sizePrices: {'28x16': 18}, tag: ''
  },
  {
    id: 23, category: 'bolsas', title: 'Frasqueira transversal P', price: 12, images: ['bolsa23.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Estampado em pvc'], sizes: ['18x12x12'],
    sizePrices: {'18x12x12': 12}, tag: ''
  },
  //Mochilas
  {
    id: 24, category: 'bolsas', title: 'Mochila em pvc', price: 10, images: ['bolsa24.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Pvc'], sizes: ['20x16','22x18','20x25','25x30'],
    sizePrices: {'20x16': 10,'22x18': 12,'20x25': 15,'25x30': 20}, tag: ''
  },
  {
    id: 25, category: 'bolsas', title: 'Mochila em estampa total em pvc', price: 10, images: ['bolsa27.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Estampado em pvc'], sizes: ['20x25'],
    sizePrices: {'20x25': 10}, tag: ''
  },
  {
    id: 26, category: 'bolsas', title: 'Bag estampa total em pvc', price: 9, images: ['bolsa28.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Estampado em pvc'], sizes: ['18x25'],
    sizePrices: {'18x25': 12}, tag: ''
  },
  {
    id: 27, category: 'bolsas', title: 'Mochila 3D em pvc e bolso frontal', price: 20, images: ['bolsa29.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Pvc'], sizes: ['20x25'],
    sizePrices: {'20x25': 20}, tag: ''
  },
  //bolsas de m√£o
  {
    id: 28, category: 'bolsas', title: 'Bolsa de m√£o em pl√°stico cristal com aplique do personagem em 3D recorte total', price: 14, images: ['bolsa25.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Cristal'], sizes: ['18x14','20x16','22x18','20x25'],
    sizePrices: {'18x14': 14,'20x16': 16,'22x18': 18,'20x25':20}, tag: ''
  },
  {
    id: 29, category: 'bolsas', title: 'Bolsa de m√£o 3D', price: 9, images: ['bolsa26.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Pvc'], sizes: ['16x12','18x14','20x16','22x18','20x25'],
    sizePrices: {'16x12':9,'18x14': 14,'20x16': 16,'22x18': 18,'20x25':20}, tag: ''
  },
  {
    id: 30, category: 'bolsas', title: 'Bolsa de m√£o em pl√°stico cristal com tag personalizada', price: 9.5, images: ['bolsa30.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Cristal'], sizes: ['16x12','18x14','20x16','22x18','26x16','30x20'],
    sizePrices: {'16x12':9.5,'18x14': 11,'20x16': 13,'22x18': 15,'26x16':18,'30x20':20}, tag: ''
  },  
  {
    id: 31, category: 'bolsas', title: 'Personaliza√ß√£o em pl√°stico cristal', price: 9.5, images: ['bolsa31.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Cristal'], sizes: ['14x14','16x16','18x18','20x20'],
    sizePrices: {'14x14': 9.5,'16x16': 11,'18x18': 12.5,'20x20':14}, tag: ''
  },
  {
    id: 32, category: 'bolsas', title: 'Bolsa de m√£o em alklear', price: 16, images: ['bolsa32.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['√önico'], sizes: ['22x18 e lateral 11'],
    sizePrices: {'22x18 e lateral 11': 16}, tag: ''
  },
  {
    id: 33, category: 'bolsas', title: 'Bolsa de m√£o 3D com hologr√°fico', price: 15, images: ['bolsa33.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Hologr√°fico'], sizes: ['20x16'],
    sizePrices: {'20x16': 15}, tag: ''
  },  
  {
    id: 34, category: 'bolsas', title: 'Maletinha de m√£o em pvc', price: 8, images: ['bolsa34.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Pvc'], sizes: ['16x12','18x14','20x16','22x18','20x25'],
    sizePrices: {'16x12':8,'18x14': 9.5,'20x16': 11,'22x18': 13.5,'20x25':15.5}, tag: ''
  },
  {
    id: 35, category: 'bolsas', title: 'Bolsa de m√£o retangular em p√©', price: 7, images: ['bolsa35.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Pvc'], sizes: ['16x12','18x14','20x16','22x12','20x25'],
    sizePrices: {'16x12':7,'18x14': 8,'20x16': 9.5,'22x12':11,'20x25':15}, tag: ''
  },
  {
    id: 36, category: 'bolsas', title: 'Bolsa de m√£o visor cristal', price: 8.5, images: ['bolsa36.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Pvc mais Cristal'], sizes: ['16x12','18x14','20x16','22x18','20x25'],
    sizePrices: {'16x12':8.5,'18x14': 9.5,'20x16': 11,'22x18': 14,'20x25':16}, tag: ''
  },  
  {
    id: 37, category: 'bolsas', title: 'Bolsa de m√£o quadrada', price: 7, images: ['bolsa37.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Cristal'], sizes: ['14x14','16x16','18x18','20x20','22x22','24x24'],
    sizePrices: {'14x14': 7,'16x16':8,'18x18': 9,'20x20':10,'22x22':12,'24x24':14}, tag: ''
  },
  {
    id: 38, category: 'bolsas', title: 'Bolsa de m√£o meia lua mais bolso frontal', price: 12, images: ['bolsa38.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['√önico pvc mais cristal'], sizes: ['20x16'],
    sizePrices: {'20x16': 12}, tag: ''
  },
  {
    id: 39, category: 'bolsas', title: 'Maletinha de m√£o em verniz', price: 15, images: ['bolsa39.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Frente costa e tampa √© estampado e laterais de verniz'], sizes: ['20x16'],
    sizePrices: {'20x16': 15}, tag: ''
  },   
  {
    id: 40, category: 'bolsas', title: 'Bolsa de m√£o com bolso frontal com pelicula em cristal e lantejoulas ou glitter', price: 9, images: ['bolsa40.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Pvc e bolso em cristal'], sizes: ['16x12','18x14','20x16','22x18','20x25'],
    sizePrices: {'16x12':9,'18x14': 10,'20x16': 12,'22x18': 14,'20x25':16}, tag: ''
  },   
  {
    id: 41, category: 'bolsas', title: 'Bolsa de m√£o em Pvc', price: 12, images: ['bolsa41.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Pvc'], sizes: ['20x16'],
    sizePrices: {'20x16': 12}, tag: ''
  },
  {
    id: 42, category: 'bolsas', title: 'Bolsa de m√£o em p√© modelo porta chuteira', price: 12, images: ['bolsa42.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Pvc'], sizes: ['16x12','18x14','20x16','22x18','20x25','27x16 para chuteira infantil','30x20 para chuteira de adulto'],
    sizePrices: {'16x12':7,'18x14':8,'20x16':9,'22x18':11,'20x25':13,'27x16 para chuteira infantil':16,'30x20 para chuteira de adulto':18}, tag: ''
  },  
  //bolsa grandes 
  {
    id: 43, category: 'bolsas', title: 'Sacola de praia infantil', price: 15, images: ['bolsa43.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Pl√°stico cristal'], sizes: ['28x25'],
    sizePrices: {'28x25': 15}, tag: ''
  },
  {
    id: 44, category: 'bolsas', title: 'Bolsa de ombro', price: 14, images: ['bolsa44.jpeg'],
    colors: ['#ff69b4', '#fce5b2'], fabrics: ['Verniz'], sizes: ['28x22'],
    sizePrices: {'28x22': 14}, tag: ''
  },
  // KITS
  {
    id: 48, category: 'kits', title: 'Kit 1 : 2 toalhas e 2 sacos higiene', price: 50, images: ['kit5.jpeg'],
    colors: ['#ffb6d9', '#9df3c4'], fabrics: ['Plush', 'Alklear'], sizes: ['√önico'], tag: 'best'
  },
  {
    id: 49, category: 'kits', title: '1 necesseire 22x18 2 sacos higiene e 2 toalhas', price: 85, images: ['kit6.jpeg'],
    colors: ['#c5b6ff', '#87ceeb'], fabrics: ['Couro Sint√©tico'], sizes: ['G'], tag: ''
  },
  {
    id: 50, category: 'kits', title: '1 necesseire 22x18 2 toalhas', price: 50, images: ['kit4.jpeg'],
    colors: ['#ffb6d9', '#9df3c4'], fabrics: ['Plush'], sizes: ['G'], tag: 'best'
  },
  {
    id: 51, category: 'kits', title: '2 sacos higiene e 2 toalhas lavabinho', price: 65, images: ['kit3.jpeg'],
    colors: ['#c5b6ff', '#87ceeb'], fabrics: ['Couro Sint√©tico'], sizes: ['√önico'], tag: ''
  },
  {
    id: 52, category: 'kits', title: 'Bolsa mais kit de pintura', price: 12, images: ['kit1.jpeg'],
    colors: ['#c5b6ff', '#87ceeb'], fabrics: ['16 desenhos, capa colorida e 3 giz P'], sizes: ['√önico'], tag: ''
  },
  {
    id: 53, category: 'kits', title: 'Kit estojo e necesseire', price: 55, images: ['kit2.jpeg'],
    colors: ['#c5b6ff', '#87ceeb'], fabrics: ['16 desenhos, capa colorida e 3 giz P'], sizes: ['Necesseire mede 22x18 e estojo mede 20x10 '], tag: ''
  },
  {
    id: 54, category: 'kits', title: 'Kit maleta de pl√°stico e necesseire box', price: 18, images: ['kit7.jpeg'],
    colors: ['#c5b6ff', '#87ceeb'], fabrics: ['maleta de cristal e necesseire estampa total'], sizes: ['Maleta mede 22x18 e a necesseire box mede 18x8'], tag: ''
  },
  // COPOS
  {
    id: 55, category: 'copos', title: 'Long drink 350ml', price: 4.5, images: ['copo1.jpeg'],
    colors: ['#008000','#ff0000','#89cff0','#00ced1','#008b8b','#9370db','#32cd32','#ff8c00','#000000','#ffd700','#ff1493','#002366','#daa520','#ffb6c1'],
    fabrics: ['Acr√≠lico'], sizes: ['350ml'], tag: 'best'
  },
  {
    id: 56, category: 'copos', title: 'Long drink jateado 350ml', price: 5, images: ['copo4.jpeg'],
    colors: ['#008000','#ff0000','#89cff0','#00ced1','#008b8b','#9370db','#32cd32','#ff8c00','#000000','#ffd700','#ff1493','#002366','#daa520','#ffb6c1'], fabrics: ['Acrilico'], sizes: ['350ml'], tag: 'best'
  },
  {
    id: 57, category: 'copos', title: 'Long drink tampa plana 350ml', price: 4.3, images: ['copo2.jpeg'],
    colors: ['#008000','#ff0000','#89cff0','#00ced1','#008b8b','#9370db','#32cd32','#ff8c00','#000000','#ffd700','#ff1493','#002366','#daa520','#ffb6c1'], fabrics: ['Acr√≠lico'], sizes: ['350ml'], tag: 'best'
  },
  {
    id: 58, category: 'copos', title: 'Long drink jateado tampa plana 350ml', price: 5, images: ['copo3.jpeg'],
    colors: ['#008000','#ff0000','#89cff0','#00ced1','#008b8b','#9370db','#32cd32','#ff8c00','#000000','#ffd700','#ff1493','#002366','#daa520','#ffb6c1'], fabrics: ['Acrilico'], sizes: ['350ml'], tag: ''
  },
  {
    id: 59, category: 'copos', title: 'Long baby jateado tampa plana de canudo 250ml', price: 4.50, images: ['copo5.jpeg'],
    colors: ['#008000','#ff0000','#89cff0','#00ced1','#008b8b','#9370db','#32cd32','#ff8c00','#000000','#ffd700','#ff1493','#002366','#daa520','#ffb6c1'], fabrics: ['Acr√≠lico'], sizes: ['250ml'], tag: 'best'
  },
  {
    id: 60, category: 'copos', title: 'Long baby jateado tampa 250ml', price: 4.50, images: ['copo10.jpeg'],
    colors: ['#008000','#ff0000','#89cff0','#00ced1','#008b8b','#9370db','#32cd32','#ff8c00','#000000','#ffd700','#ff1493','#002366','#daa520','#ffb6c1'], fabrics: ['Acr√≠lico'], sizes: ['250ml'], tag: ''
  },
  {
    id: 61, category: 'copos', title: 'Copo caldereta sem tampa 550ml', price: 3.5, images: ['copo6.jpeg'],
    colors: ['#008000','#ff0000','#89cff0','#00ced1','#008b8b','#9370db','#32cd32','#ff8c00','#000000','#ffd700','#ff1493','#002366','#daa520','#ffb6c1'], fabrics: ['Cer√¢mica'], sizes: ['550ml'], tag: 'best'
  },
  {
    id: 62, category: 'copos', title: 'Copo caldereta jateado com tampa plana de canudo 550ml', price: 6, images: ['copo7.jpeg'],
    colors: ['#008000','#ff0000','#89cff0','#00ced1','#008b8b','#9370db','#32cd32','#ff8c00','#000000','#ffd700','#ff1493','#002366','#daa520','#ffb6c1'], fabrics: ['Acr√≠lico'], sizes: ['550ml'], tag: 'best'
  },
  {
    id: 63, category: 'copos', title: 'Copo caldereta tampa shake 550ml', price: 5.5, images: ['copo8.jpeg'],
    colors: ['#008000','#ff0000','#89cff0','#00ced1','#008b8b','#9370db','#32cd32','#ff8c00','#000000','#ffd700','#ff1493','#002366','#daa520','#ffb6c1'], fabrics: ['Cer√¢mica'], sizes: ['550ml'], tag: 'best'
  },
  {
    id: 64, category: 'copos', title: 'Garrafa ECO 400ml com al√ßa', price: 8.5, images: ['copo11.jpeg'],
    colors: ['#008000','#ff0000','#89cff0','#00ced1','#008b8b','#9370db','#32cd32','#ff8c00','#000000','#ffd700','#ff1493','#002366','#daa520','#ffb6c1'], fabrics: ['ECO'], sizes: ['400ml'], tag: ''
  },
  {
    id: 65, category: 'copos', title: 'Garrafa ECO jateada com al√ßa 400ml', price: 9, images: ['copo12.jpeg'],
    colors: ['#008000','#ff0000','#89cff0','#00ced1','#008b8b','#9370db','#32cd32','#ff8c00','#000000','#ffd700','#ff1493','#002366','#daa520','#ffb6c1'], fabrics: ['ECO'], sizes: ['400ml'], tag: ''
  },
  {
    id: 66, category: 'copos', title: 'Copo flexivel com tampa shake 400ml', price: 5, images: ['copo13.jpeg'],
    colors: ['#008000','#ff0000','#89cff0','#00ced1','#008b8b','#9370db','#32cd32','#ff8c00','#000000','#ffd700','#ff1493','#002366','#daa520','#ffb6c1'], fabrics: ['Acr√≠lico'], sizes: ['400ml'], tag: ''
  },
  {
    id: 67, category: 'copos', title: 'Garrafa ECO com fibra de bambu 400ml', price: 7.5, images: ['copo14.jpeg'],
    colors: ['#008000','#ff0000','#89cff0','#00ced1','#008b8b','#9370db','#32cd32','#ff8c00','#000000','#ffd700','#ff1493','#002366','#daa520','#ffb6c1'], fabrics: ['ECO e Fibra de Bambu'], sizes: ['400ml'], tag: ''
  },
  {
    id: 68, category: 'copos', title: 'Long baby tampa plana de canudo 250ml', price: 3.5, images: ['copo15.jpeg'],
    colors: ['#008000','#ff0000','#89cff0','#00ced1','#008b8b','#9370db','#32cd32','#ff8c00','#000000','#ffd700','#ff1493','#002366','#daa520','#ffb6c1'], fabrics: ['Acr√≠lico'], sizes: ['250ml'], tag: ''
  },
  {
    id: 69, category: 'copos', title: 'Copo Long baby 250ml', price: 3.8, images: ['copo16.jpeg'],
    colors: ['#008000','#ff0000','#89cff0','#00ced1','#008b8b','#9370db','#32cd32','#ff8c00','#000000','#ffd700','#ff1493','#002366','#daa520','#ffb6c1'], fabrics: ['Acr√≠lico'], sizes: ['250ml'], tag: 'best'
  },
  
  // TOALHAS
  {
    id: 70, category: 'toalhas', title: 'Toalha lavabinho minimo 3 unidades', price: 55, images: ['toalha1.jpeg'],
    colors: [], fabrics: ['Algod√£o'], sizes: ['√önico'], tag: ''
  },
  {
    id: 71, category: 'toalhas', title: 'Toalha de m√£o pacote com 5 unidades', price: 60, images: ['toalha2.jpeg'],
    colors: [], fabrics: ['Algod√£o'], sizes: ['√önico'], tag: 'best'
  }
];

let CART = JSON.parse(localStorage.getItem('glaumimos_cart')) || [];
let FAVORITES = JSON.parse(localStorage.getItem('glaumimos_favs')) || [];
let globalSettings = { color: null, fabric: null };
// sound persistence
window.SOUND_ENABLED = localStorage.getItem('glaumimos_sound') !== '0';
let currentCategory = 'todos';
let currentTag = 'all';
let currentDetailProduct = null;
let currentDetailSelection = { color: null, qty: 1, size: null };

window.onload = () => {
  renderProducts();
  renderGlobalSwatches();
  updateCartUI();
  // garantir carrinho fechado ao carregar (evita partes vis√≠veis)
  try{ const sc = $('sidebarCart'); if(sc){ sc.classList.remove('open'); } }catch(e){}
  // esconder loader com pequena transi√ß√£o
  const loader = $('siteLoader');
  if (loader) {
    loader.style.transition = 'opacity 400ms ease';
    loader.style.opacity = '0';
    setTimeout(() => { loader.style.display = 'none'; }, 450);
  }
};

function $(id) { return document.getElementById(id); }

function filterByCategory(cat) {
    currentCategory = cat;
    document.querySelectorAll('.section-btn').forEach(b => b.classList.remove('active'));
    $(`sec-${cat}`).classList.add('active');
    renderProducts();
}

function filterByTag(tag) {
    currentTag = tag;
    document.querySelectorAll('.filter-pill').forEach(b => b.classList.remove('active'));
    $(`tag-${tag}`).classList.add('active');
    renderProducts();
}

function renderProducts() {
  const container = $('gridProdutos');
  const search = $('searchInput').value.toLowerCase();
  container.innerHTML = '';

  const filtered = PRODUCTS.filter(p => {
    const matchesSearch = p.title.toLowerCase().includes(search);
    const matchesCat = currentCategory === 'todos' || p.category === currentCategory;
    const matchesTag = currentTag === 'all' || p.tag === currentTag || (currentTag === 'fav' && FAVORITES.indexOf(p.id)!==-1);
    return matchesSearch && matchesCat && matchesTag;
  });

  filtered.forEach((p, idx) => {
    const card = document.createElement('div');
    card.className = 'card';
    card.style.animationDelay = (idx * 40) + 'ms';
    const badge = p.tag === 'promo' ? 'Promo' : p.tag === 'best' ? 'Mais Vendido' : p.tag === 'fav' ? 'Favorito' : '';
    card.innerHTML = `
      ${badge ? `<div class="badge-tag">${badge}</div>` : ''}
      <img src="${p.images[0]}" class="img" loading="lazy" alt="${p.title}">
      <h3 style="font-size:14px; margin:12px 0 5px; min-height:40px">${p.title}</h3>
      <div class="price">R$ ${p.price.toFixed(2)}</div>
      <button class="btn btn-add btn-stars" onclick="quickAdd(${p.id}, this)">
        <span>Adicionar</span>
        <div class="star-1"><svg width="28" height="28" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" class="fil0"/></svg></div>
        <div class="star-2"><svg width="20" height="20" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8" class="fil0"/></svg></div>
        <div class="star-3"><svg width="10" height="10" viewBox="0 0 24 24"><circle cx="12" cy="12" r="4" class="fil0"/></svg></div>
        <div class="star-4"><svg width="12" height="12" viewBox="0 0 24 24"><circle cx="12" cy="12" r="6" class="fil0"/></svg></div>
        <div class="star-5"><svg width="18" height="18" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" class="fil0"/></svg></div>
        <div class="star-6"><svg width="8" height="8" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3" class="fil0"/></svg></div>
      </button>
      <button class="btn btn-detail">Customizar</button>
    `;
    // add favorite star button overlay
    const favBtn = document.createElement('button');
    favBtn.className = 'fav-btn';
    favBtn.title = 'Favoritar';
    favBtn.innerHTML = (FAVORITES.indexOf(p.id) !== -1 || p.tag === 'fav') ? '‚ù§' : '‚ô°';
    if(FAVORITES.indexOf(p.id) !== -1 || p.tag === 'fav') favBtn.classList.add('active');
    favBtn.addEventListener('click', (ev) => { ev.stopPropagation(); toggleFavorite(p.id); });
    card.appendChild(favBtn);

    container.appendChild(card);
    // attach reliable listeners to avoid issues with inline onclick
    const imgEl = card.querySelector('.img');
    if(imgEl) imgEl.addEventListener('click', () => openDetail(p.id));
    const detailBtn = card.querySelector('.btn-detail');
    if(detailBtn) detailBtn.addEventListener('click', () => openDetail(p.id));
  });
}

function renderGlobalSwatches() {
  const container = $('globalSwatches');
  Object.keys(COLORS_DB).forEach(hex => {
    const div = document.createElement('div');
    div.className = 'swatch';
    div.style.background = hex;
    div.onclick = () => {
      Array.from(container.children).forEach(s => s.classList.remove('active'));
      div.classList.add('active');
      globalSettings.color = hex;
    };
    container.appendChild(div);
  });
}

function updatePriceByFabric(basePrice, category) {
  const selectedFabric = $('detailFabric').value;
  const alklearPriceEl = $('alklearPrice');
  const pompomPriceEl = $('pompomPrice');
  let finalPrice = basePrice;
  
  // Se houver pre√ßo por tamanho, usar esse pre√ßo como base
  if (currentDetailProduct && currentDetailSelection.size && currentDetailProduct.sizePrices) {
    const sizePrice = currentDetailProduct.sizePrices[currentDetailSelection.size];
    if (typeof sizePrice === 'number') basePrice = sizePrice;
  }

  // Adicionar R$ 2 se for Alklear e for bolsa
  if (selectedFabric === 'Alklear' && category === 'bolsas') {
    finalPrice = basePrice + 2;
    alklearPriceEl.style.display = 'inline';
  } else {
    finalPrice = basePrice;
    alklearPriceEl.style.display = 'none';
  }

  // Se a op√ß√£o pompom estiver marcada para a bolsa id 44, adicionar +R$2
  try{
    const pompomChk = $('detailPompom');
    if (currentDetailProduct && currentDetailProduct.id === 44 && pompomChk && pompomChk.checked) {
      finalPrice = finalPrice + 2;
      if(pompomPriceEl) pompomPriceEl.style.display = 'inline';
    } else {
      if(pompomPriceEl) pompomPriceEl.style.display = 'none';
    }
  }catch(e){}

  $('detailPrice').innerText = `R$ ${finalPrice.toFixed(2)}`;
  
  // Atualizar preview do tecido
  updateFabricPreview();
}

function openDetail(id) {
  const p = PRODUCTS.find(x => x.id === id);
  currentDetailProduct = p;
  // Use a cor padr√£o (global ou primeira do produto) ‚Äî escolha de cor removida
  currentDetailSelection = { colors: [], color: globalSettings.color || (p.colors && p.colors[0]) || null, qty: 1, size: p.sizes ? p.sizes[0] : null };

  $('detailTitle').innerText = p.title;
  $('detailPrice').innerText = `R$ ${p.price.toFixed(2)}`;
  $('detailImg').src = p.images[0];
  const qtyInp = $('detailQtyInput'); if(qtyInp) qtyInp.value = 1;
  // Popular swatches de cor para o modal (escolha de cor dispon√≠vel)
  const sContainer = $('detailSwatches');
  sContainer.innerHTML = '';
  if (p.colors && p.colors.length) {
    p.colors.forEach(hex => {
      const div = document.createElement('div');
      div.className = `swatch ${currentDetailSelection.color === hex ? 'active' : ''}`;
      div.style.background = hex;
      div.onclick = () => toggleDetailColor(hex, div);
      sContainer.appendChild(div);
    });
  }

  const fSelect = $('detailFabric');
  fSelect.innerHTML = p.fabrics.map(f => `<option value="${f}" ${globalSettings.fabric === f ? 'selected' : ''}>${f}</option>`).join('');
  fSelect.onchange = () => updatePriceByFabric(p.price, p.category);

  // configurar checkbox de pompom (aparece apenas para produto id 44)
  const pompomEl = $('detailPompom');
  if(pompomEl){
    pompomEl.checked = false;
    pompomEl.onchange = () => updatePriceByFabric(p.price, p.category);
    // esconder por padr√£o caso n√£o seja produto 44
    if(currentDetailProduct && currentDetailProduct.id === 44){ pompomEl.parentElement.style.display = 'flex'; }
    else { pompomEl.parentElement.style.display = 'none'; }
  }

  const sSelect = $('detailSize');
  if (p.sizes && p.sizes.length > 0) {
    sSelect.innerHTML = p.sizes.map(s => {
      const sp = (p.sizePrices && p.sizePrices[s]) ? p.sizePrices[s] : p.price;
      const delta = sp - p.price;
      // para o produto id:1 removemos o r√≥tulo lateral de "(+R$ ...)" e exibimos apenas o pre√ßo final
      const showDeltaLabel = p.id !== 1;
      const deltaLabel = (!showDeltaLabel || delta === 0) ? '' : (delta > 0 ? ` (+R$ ${delta.toFixed(2)})` : ` (-R$ ${Math.abs(delta).toFixed(2)})`);
      return `<option value="${s}" ${s === currentDetailSelection.size ? 'selected' : ''}>${s} ‚Äî R$ ${sp.toFixed(2)}${deltaLabel}</option>`;
    }).join('');
    sSelect.onchange = () => { currentDetailSelection.size = sSelect.value; updatePriceByFabric(currentDetailProduct.price, currentDetailProduct.category); };
  } else {
    sSelect.innerHTML = '<option value="√önico">√önico</option>';
    currentDetailSelection.size = '√önico';
  }

  // Atualiza pre√ßo ao abrir o modal com base no tamanho/tecido atuais
  updateVisualPreview();
  updatePriceByFabric(p.price, p.category);
  // atualizar preview do tecido selecionado
  updateFabricPreview();
  updateAllocationUI();
  const dm = $('detailModal');
  if(dm){ dm.classList.add('open'); dm.style.display = 'flex'; dm.setAttribute('aria-hidden','false'); document.body.style.overflow = 'hidden'; }
}
// ensure body scroll restored when modal closed

// sele√ß√£o de cor removida ‚Äî cor definida pelo padr√£o/global

function updateVisualPreview() {
  const hex = currentDetailSelection.color;
  $('detailImg').style.borderColor = hex;
  $('detailImg').style.boxShadow = `0 15px 40px ${hex}55`;
  $('colorNameDisplay').innerText = `Cor: ${COLORS_DB[hex] || 'Personalizada'}`;
}

// Fabric Preview and Lightbox Functions
const FABRIC_PREVIEWS = {
  'Alklear': 'ü™°',
  'Pl√°stico cristal': 'üíé',
  'Pvc': 'üéÄ',
  'Verniz': '‚ú®',
  'Cristal': 'üíé',
  'Plush': 'üß∏',
  'Couro Sint√©tico': 'üéØ',
  'Neoprene': 'üèñÔ∏è',
  'Estampado em pvc': 'üé®',
  'Hologr√°fico': 'üåà',
  'Acr√≠lico': 'üî∑',
  'Algod√£o': 'üåæ',
  'ECO': 'üå±',
  'ECO e Fibra de Bambu': 'üéã',
  'Pvc mais Cristal': 'üíé',
  '√önico pvc mais cristal': 'üíé',
  'Frente costa e tampa √© estampado e laterais de verniz': '‚ú®',
  'Pvc e bolso em cristal': 'üíé',
  '16 desenhos, capa colorida e 3 giz P': 'üé®'
};

function updateFabricPreview() {
  const fabric = $('detailFabric').value;
  const previewEl = $('fabricPreview');
  if (!previewEl) return;
  
  const emoji = FABRIC_PREVIEWS[fabric] || 'üßµ';
  previewEl.innerHTML = emoji;
  previewEl.style.background = 'linear-gradient(135deg, #fff0f7 0%, #ffd6ea 100%)';
  previewEl.onclick = () => openFabricLightbox(fabric);
}

function openFabricLightbox(fabric) {
  const lightbox = $('fabricLightbox');
  const titleEl = $('fabricLightboxTitle');
  const imgEl = $('fabricLightboxImg');
  
  if (!lightbox) return;
  
  titleEl.innerText = fabric;
  imgEl.src = '';
  imgEl.style.display = 'block';
  
  // Tentar carregar imagem real de fabrics/ (se existir)
  const imgPath = `fabrics/${fabric.toLowerCase().replace(/\s+/g, '-')}.jpg`;
  imgEl.onerror = () => {
    // Se n√£o houver imagem, mostrar apenas o emoji grande
    imgEl.style.display = 'none';
  };
  imgEl.src = imgPath;
  
  lightbox.classList.add('open');
}

function closeFabricLightbox() {
  const lightbox = $('fabricLightbox');
  if (lightbox) lightbox.classList.remove('open');
}

function selectDetailColor(hex, el) {
  currentDetailSelection.color = hex;
  // legacy single-select replaced by toggle behavior; keep for compatibility
  currentDetailSelection.colors = [hex];
  Array.from($('detailSwatches').children).forEach(s => s.classList.remove('active'));
  el.classList.add('active');
  updateVisualPreview();
}

function toggleDetailColor(hex, el){
  if(!currentDetailSelection.colors) currentDetailSelection.colors = [];
  const idx = currentDetailSelection.colors.indexOf(hex);
  if(idx === -1){
    currentDetailSelection.colors.push(hex);
    el.classList.add('active');
  } else {
    currentDetailSelection.colors.splice(idx,1);
    el.classList.remove('active');
  }
  // keep singular color for legacy preview
  currentDetailSelection.color = currentDetailSelection.colors[0] || null;
  updateVisualPreview();
  updateAllocationUI();
}

function updateDetailQty(delta) {
  // support both delta (increment/decrement) and explicit value
  if(typeof delta === 'number'){
    currentDetailSelection.qty = Math.max(1, currentDetailSelection.qty + delta);
  }
  // update input and optional display
  const inp = $('detailQtyInput');
  if(inp) inp.value = currentDetailSelection.qty;
  const disp = $('detailQtyDisplay');
  if(disp) disp.innerText = currentDetailSelection.qty;
  updateAllocationUI();
}

function setDetailQtyFromInput(val){
  const n = Math.max(1, parseInt(val)||1);
  currentDetailSelection.qty = n;
  const inp = $('detailQtyInput'); if(inp) inp.value = n;
  const disp = $('detailQtyDisplay'); if(disp) disp.innerText = n;
  updateAllocationUI();
}

function quickAdd(id, el) {
  const p = PRODUCTS.find(x => x.id === id);
  const selection = {
    color: globalSettings.color || (p.colors && p.colors[0]) || null,
    fabric: globalSettings.fabric || p.fabrics[0],
    size: p.sizes ? p.sizes[0] : null,
    qty: 1
  };
  const baseSizePrice = (p && p.sizePrices && selection.size) ? (p.sizePrices[selection.size] || p.price) : p.price;
  CART.push({ ...p, price: baseSizePrice, selection });
  updateCartUI();
  toggleCart();
}

function addItemFromModal() {
  const selection = {
    colors: currentDetailSelection.colors && currentDetailSelection.colors.length ? currentDetailSelection.colors.slice() : (currentDetailSelection.color ? [currentDetailSelection.color] : []),
    color: currentDetailSelection.color || (currentDetailSelection.colors && currentDetailSelection.colors[0]) || null,
    fabric: $('detailFabric').value,
    size: $('detailSize').value || currentDetailSelection.size,
    qty: currentDetailSelection.qty,
    // nome/tema removidos
  };
  // incluir op√ß√£o pompom (somente se estiver no modal)
  try{ selection.pompom = !!($('detailPompom') && $('detailPompom').checked); }catch(e){ selection.pompom = false; }
  // incluir nome do cliente se preenchido no modal
  try{ const cname = ($('detailClientName') && $('detailClientName').value) ? $('detailClientName').value.trim() : ''; if(cname) selection.clientName = cname; }catch(e){}

  // Valida√ß√£o/override de aloca√ß√£o
  const v = validateAllocationBeforeAdd();
  if(!v.ok){
    $('allocationInfo').innerText = v.msg;
    return alert(v.msg);
  }
  // se houver aloca√ß√£o personalizada, inclua-a
  if(currentDetailSelection._alloc) selection.allocations = Object.assign({}, currentDetailSelection._alloc);
  
  // Calcular pre√ßo base baseado no tamanho selecionado
  const baseSizePrice = (currentDetailProduct && currentDetailProduct.sizePrices && selection.size) ? (currentDetailProduct.sizePrices[selection.size] || currentDetailProduct.price) : currentDetailProduct.price;
  // Adicionar ajuste de pre√ßo para Alklear em bolsas
  let priceAdjustment = 0;
  if (selection.fabric === 'Alklear' && currentDetailProduct.category === 'bolsas') {
    priceAdjustment = 2;
  }
  // Adicionar ajuste para pompom na bolsa id 44
  if (selection.pompom && currentDetailProduct && currentDetailProduct.id === 44) {
    priceAdjustment += 2;
  }

  const item = { ...currentDetailProduct, price: baseSizePrice, selection, priceAdjustment };
  CART.push(item);
  updateCartUI();
  closeDetail();
  toggleCart();
}

// When rendering cart items, if allocations present show breakdown
// (updateCartUI already renders colors; allocations shown below title)

function updateCartUI() {
  localStorage.setItem('glaumimos_cart', JSON.stringify(CART));
  const list = $('cartList');
  list.innerHTML = '';
  let total = 0;

  CART.forEach((item, idx) => {
    const priceAdjustment = item.priceAdjustment || 0;
    total += (item.price + priceAdjustment) * item.selection.qty;
    const div = document.createElement('div');
    div.className = 'cart-item';
    // build color display (support multiple colors)
    const colorDisplay = item.selection.colors && item.selection.colors.length ? item.selection.colors.map(c => (COLORS_DB[c] || c)).join(', ') : (COLORS_DB[item.selection.color] || item.selection.color || '‚Äî');
    // build allocations html if present
    const allocations = item.selection.allocations || item.selection._alloc || null;
    let allocationsHtml = '';
    if(allocations){
      const parts = Object.keys(allocations).map(h => `${(COLORS_DB[h]||h)}: ${allocations[h]}`);
      allocationsHtml = `<div style="font-size:12px; color:#5a3b4f; margin-top:6px">Distribui√ß√£o: ${parts.join(' ‚Ä¢ ')}</div>`;
    }
    const pompomHtml = (item.selection && item.selection.pompom) ? `<div style="color:#5a3b4f; font-size:13px; margin-top:6px">Pompom: <strong>Sim</strong></div>` : '';

    div.innerHTML = `
      <img src="${item.images[0]}">
      <div style="flex:1">
        <div style="font-weight:700; font-size:14px">${item.title}</div>
        <small>${colorDisplay} | ${item.selection.fabric} | ${item.selection.size}</small><br>
        <small style="color:var(--accent)">Ref: ${item.selection.name} / ${item.selection.theme}</small>
        ${pompomHtml}
        ${allocationsHtml}
      </div>
      <div style="display:flex; align-items:center; gap:10px; margin-left:10px">
        <div class="numeric-input">
          <button class="qty-btn" onclick="changeCartQty(${idx}, -1)">‚àí</button>
          <input type="number" min="1" class="cart-qty-input" value="${item.selection.qty}" onchange="onCartQtyInputChange(this, ${idx})">
          <button class="qty-btn" onclick="changeCartQty(${idx}, 1)">+</button>
        </div>
        <div class="qty-subtotal">R$ ${( (item.price + priceAdjustment) * item.selection.qty ).toFixed(2)}</div>
        <button class="cart-remove" onclick="removeFromCart(${idx})" title="Remover item do carrinho">üóëÔ∏è</button>
      </div>
    `;
    list.appendChild(div);
  });

  $('cartTotal').innerText = `R$ ${total.toFixed(2)}`;
  $('countBadge').innerText = CART.length;
  $('countBadgeText').innerText = CART.length;
}

function removeFromCart(idx) { CART.splice(idx, 1); updateCartUI(); }
function toggleCart() {
  const sc = $('sidebarCart');
  if(!sc) return;
  sc.classList.toggle('open');
  // When the cart is open, prevent body scroll (mobile bottom-sheet); restore when closed
  if(sc.classList.contains('open')){
    document.body.style.overflow = 'hidden';
  } else {
    document.body.style.overflow = '';
  }
}
function closeDetail() {
  const dm = $('detailModal');
  if(!dm) return;
  dm.classList.remove('open');
  dm.setAttribute('aria-hidden','true');
  document.body.style.overflow = '';
  // allow CSS closing animation (matches modalOpen keyframes)
  setTimeout(()=>{ dm.style.display = 'none'; }, 260);
}

function clearCart(){
  if(!confirm('Tem certeza que deseja limpar todo o carrinho?')) return;
  CART = [];
  updateCartUI();
  try{ if(window.SOUND_ENABLED) playClick('default'); }catch(e){}
}

function changeCartQty(idx, delta) {
  const item = CART[idx];
  if (!item) return;
  item.selection.qty = Math.max(1, item.selection.qty + delta);
  updateCartUI();
}

function onCartQtyInputChange(el, idx){
  const n = Math.max(1, parseInt(el.value)||1);
  const item = CART[idx];
  if(!item) return;
  item.selection.qty = n;
  updateCartUI();
}

function applyGlobalSettings() {
  globalSettings.fabric = $('globalTecido').value;
  alert("Prefer√™ncias aplicadas com sucesso!");
}

function updateAllocationUI(){
  const qty = currentDetailSelection.qty || 0;
  const minTotal = 20;
  const minPerColor = 10;
  const requiredColors = Math.max(1, Math.ceil(qty / minPerColor));
  const selectedColors = (currentDetailSelection.colors && currentDetailSelection.colors.length) ? currentDetailSelection.colors.length : 0;
  const colorsNeeded = Math.max(0, requiredColors - selectedColors);
  const missingTotal = Math.max(0, minTotal - qty);
  const infoEl = $('allocationInfo');
  if(infoEl){
    infoEl.innerText = `Cores selecionadas: ${selectedColors} ‚Äî Cores necess√°rias: ${requiredColors}. ${ missingTotal>0 ? ('Faltam '+missingTotal+' bolsas para o m√≠nimo total.') : 'Quantidade total OK.'}`;
  }
  const btn = $('checkAllocationBtn');
  if(btn){
    if(colorsNeeded>0){ btn.innerText = `Faltam ${colorsNeeded} cor(es)`; btn.style.background='#ffd6e8'; }
    else { btn.innerText = 'Cores OK'; btn.style.background='linear-gradient(135deg,#c5b6ff,#ffb6d9)'; }
  }
  // allocation inputs: show when qty >= minTotal but qty < selectedColors*minPerColor (insufficient per-color minimum)
  const allocWrap = $('allocationInputs');
  if(!allocWrap) return;
  allocWrap.innerHTML = '';
  const customToggle = $('customDistrib');
  const customEnabled = customToggle && customToggle.checked;
  // show inputs if manual distribution enabled OR if automatic conditions require allocations
  if(selectedColors > 0 && (customEnabled || (qty >= minTotal && qty < selectedColors * minPerColor))){
    if(selectedColors > 6){
      allocWrap.innerHTML = `<div style="color:#c0392b; font-size:13px">Selecione no m√°ximo 6 cores para distribui√ß√£o personalizada.</div>`;
      return;
    }
    allocWrap.innerHTML = `<div style="font-size:13px; color:#5a3b4f; margin-bottom:6px">Distribua a quantidade entre as ${selectedColors} cor(es). Total: <strong>${qty}</strong></div>`;
    // default equal distribution (or use existing allocation)
    const base = Math.floor(qty / selectedColors);
    let remain = qty - base * selectedColors;
    currentDetailSelection._alloc = currentDetailSelection._alloc || {};
    currentDetailSelection.colors.forEach((hex, i) => {
      const val = (currentDetailSelection._alloc[hex] && !customEnabled) ? currentDetailSelection._alloc[hex] : (base + (remain>0?1:0));
      if(remain>0) remain--;
      currentDetailSelection._alloc[hex] = val;
      const row = document.createElement('div');
      row.style.display = 'flex'; row.style.alignItems='center'; row.style.gap='8px'; row.style.marginBottom='6px';
      row.innerHTML = `<div style="width:22px; height:22px; border-radius:50%; background:${hex}; border:2px solid #fff"></div><input type="number" min="0" value="${val}" data-hex="${hex}" style="width:90px; padding:6px;">`;
      allocWrap.appendChild(row);
    });
    const note = document.createElement('div');
    note.style.fontSize='12px'; note.style.color='#6b4a60'; note.style.marginTop='6px'; note.innerText = 'A soma deve ser igual ao total pedido.';
    allocWrap.appendChild(note);
    // attach listener to validate inputs and update allocation map
    allocWrap.querySelectorAll('input[type=number]').forEach(inp=>{
      inp.addEventListener('input', () => {
        const map = {};
        let sum = 0;
        allocWrap.querySelectorAll('input[type=number]').forEach(i=>{ const n = Math.max(0, parseInt(i.value)||0); map[i.dataset.hex]=n; sum+=n; });
        currentDetailSelection._alloc = map;
        const ok = (sum === qty);
        note.style.color = ok ? '#2a7a2a' : '#c0392b';
        note.innerText = ok ? 'Distribui√ß√£o v√°lida.' : `Soma atual: ${sum} ‚Äî precisa ser ${qty}.`;
      });
    });
  }
}

function validateAllocationBeforeAdd(){
  const qty = currentDetailSelection.qty || 0;
  const minTotal = 20;
  if(qty < minTotal) return {ok:false, msg: `Quantidade m√≠nima total √© ${minTotal}.`};
  const sel = (currentDetailSelection.colors && currentDetailSelection.colors.length) ? currentDetailSelection.colors.length : 0;
  if(sel === 0) return {ok:false, msg: 'Selecione ao menos 1 cor.'};
  const requiredByColors = sel * 10;
  // if qty >= requiredByColors normal path
  if(qty >= requiredByColors) return {ok:true};
  // else if sel>3 not allowed
  if(sel > 3) return {ok:false, msg: 'Selecione no m√°ximo 3 cores para distribui√ß√£o personalizada.'};
  // ensure allocations present and sum equals qty
  const alloc = currentDetailSelection._alloc || {};
  let sum = 0; let countVals=0;
  Object.keys(alloc).forEach(k=>{ const v = Math.max(0, parseInt(alloc[k])||0); sum+=v; if(v>0) countVals++; });
  if(sum !== qty) return {ok:false, msg: `A soma das aloca√ß√µes √© ${sum}. Deve ser ${qty}.`};
  if(countVals > sel) return {ok:false, msg: 'Verifique as aloca√ß√µes.'};
  return {ok:true};
}

// Favorites
function toggleFavorite(id){
  const idx = FAVORITES.indexOf(id);
  if(idx === -1) FAVORITES.push(id); else FAVORITES.splice(idx,1);
  localStorage.setItem('glaumimos_favs', JSON.stringify(FAVORITES));
  try{ if(window.SOUND_ENABLED) playClick('soft'); }catch(e){}
  renderProducts();
}

// Sound engine (simple WebAudio feedback)
(function(){
  let audioCtx = null;
  function ensureAudio(){
    if(!audioCtx){
      try{ audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }catch(e){ audioCtx = null; }
    }
    return audioCtx;
  }

  window.playClick = function(type){
    if(window.SOUND_ENABLED === false) return;
    const ctx = ensureAudio();
    if(!ctx) return;
    const now = ctx.currentTime;
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    if(type === 'confirm'){
      o.type = 'sine'; o.frequency.setValueAtTime(760, now);
      g.gain.setValueAtTime(0, now); g.gain.linearRampToValueAtTime(0.12, now+0.004); g.gain.exponentialRampToValueAtTime(0.0001, now+0.28);
      o.connect(g); g.connect(ctx.destination); o.start(now); o.stop(now+0.32);
    } else if(type === 'page'){
      o.type = 'sine'; o.frequency.setValueAtTime(520, now); o.frequency.linearRampToValueAtTime(820, now+0.12);
      g.gain.setValueAtTime(0, now); g.gain.linearRampToValueAtTime(0.045, now+0.008); g.gain.exponentialRampToValueAtTime(0.0001, now+0.22);
      o.connect(g); g.connect(ctx.destination); o.start(now); o.stop(now+0.24);
    } else if(type === 'soft'){
      o.type = 'sine'; o.frequency.setValueAtTime(1100, now);
      g.gain.setValueAtTime(0, now); g.gain.linearRampToValueAtTime(0.045, now+0.002); g.gain.exponentialRampToValueAtTime(0.0001, now+0.09);
      o.connect(g); g.connect(ctx.destination); o.start(now); o.stop(now+0.10);
    } else {
      o.type = 'square'; o.frequency.setValueAtTime(1000, now);
      g.gain.setValueAtTime(0, now); g.gain.linearRampToValueAtTime(0.06, now+0.003); g.gain.exponentialRampToValueAtTime(0.0001, now+0.12);
      o.connect(g); g.connect(ctx.destination); o.start(now); o.stop(now+0.12);
    }
  };

  // Wire a simple toggle UI and pointer feedback
  window.toggleSound = function(){ window.SOUND_ENABLED = !window.SOUND_ENABLED; localStorage.setItem('glaumimos_sound', window.SOUND_ENABLED ? '1' : '0'); const el = document.getElementById('soundToggle'); if(el) el.checked = !!window.SOUND_ENABLED; };
  document.addEventListener('pointerdown', e => { const interactive = e.target.closest('button, .section-btn, .filter-pill, .swatch, .img, .btn, .qty-btn'); if(interactive){ try{ playClick('soft'); }catch(e){} } }, {passive:true});

  // init checkbox state on DOM load
  window.addEventListener('load', ()=>{ const el = document.getElementById('soundToggle'); if(el){ el.checked = !!window.SOUND_ENABLED; el.addEventListener('change', toggleSound); } });
})();

function checkAllocation(){
  updateAllocationUI();
  const info = $('allocationInfo');
  if(info) info.style.opacity = '1';
  setTimeout(()=>{ if(info) info.style.opacity=''; }, 2500);
}

function checkout() {
  if (CART.length === 0) return alert("Carrinho vazio!");
  // feedback visual no bot√£o de checkout
  const checkoutBtn = document.querySelector('#sidebarCart .checkout-wrap .btn-stars') || document.querySelector('#sidebarCart .btn-stars');
  if (checkoutBtn) {
    const span = checkoutBtn.querySelector('span');
    if (span) span.dataset._old = span.innerText;
    checkoutBtn.classList.add('confirmed');
    if (span) span.innerText = 'Enviando...';
  }

  const date = $('desiredDate').value;
  const obs = $('generalTheme').value || "Sem observa√ß√µes";
  
  let msg = `‚ú® *PEDIDO GLAUMIMOS* ‚ú®%0A%0A`;
  msg += `üìÖ *DATA:* ${date || 'A combinar'}%0A`;
  msg += `üìù *OBS:* ${obs}%0A%0A`;

  CART.forEach((it, i) => {
    msg += `*${i+1}. ${it.title}* (x${it.selection.qty})%0A`;
    const colorList = (it.selection.colors && it.selection.colors.length) ? it.selection.colors.map(c => COLORS_DB[c] || c).join(', ') : (COLORS_DB[it.selection.color] || it.selection.color || '‚Äî');
    msg += `   Cor: ${colorList}%0A`;
    msg += `   Tecido: ${it.selection.fabric}%0A`;
    msg += `   Tamanho: ${it.selection.size}%0A%0A`;
    // include per-color allocation if present
    const alloc = it.selection.allocations || it.selection._alloc || null;
    if(alloc){
      msg += `   Distribui√ß√£o por cor:%0A`;
      Object.keys(alloc).forEach(h => {
        msg += `     - ${COLORS_DB[h] || h}: ${alloc[h]}%0A`;
      });
      msg += `%0A`;
    }
    // incluir info de pompom se houver
    if(it.selection && it.selection.pompom){
      msg += `   Pompom: Sim (+R$ 2,00 por und)%0A%0A`;
    }
  });

  const total = CART.reduce((a, b) => {
    const priceAdjustment = b.priceAdjustment || 0;
    return a + ((b.price + priceAdjustment) * b.selection.qty);
  }, 0);
  msg += `*TOTAL: R$ ${total.toFixed(2)}*`;
  // abrir WhatsApp em nova aba
  window.open(`https://wa.me/${PHONE_NUMBER}?text=${msg}`, '_blank');

  // reverter feedback ap√≥s curto per√≠odo
  if (checkoutBtn) {
    setTimeout(() => {
      const span = checkoutBtn.querySelector('span');
      if (span && span.dataset._old) span.innerText = span.dataset._old;
      checkoutBtn.classList.remove('confirmed');
    }, 1400);
  }
}

// Simple press animation handler: adds `.pressed` class on pointer down, removes on up/cancel
(function(){
  function addPressed(el){
    if(!el) return;
    el.classList.add('pressed');
    if(el.dataset.pressTimeout) clearTimeout(el.dataset.pressTimeout);
    el.dataset.pressTimeout = setTimeout(()=>{ el.classList.remove('pressed'); delete el.dataset.pressTimeout; }, 260);
  }
  function removePressed(el){
    if(!el) return;
    el.classList.remove('pressed');
    if(el.dataset.pressTimeout){ clearTimeout(el.dataset.pressTimeout); delete el.dataset.pressTimeout; }
  }
  document.addEventListener('pointerdown', e => {
    const btn = e.target.closest('button, .qty-btn, .section-btn, .filter-pill');
    if(btn) addPressed(btn);
  }, {passive:true});
  document.addEventListener('pointerup', e => {
    const btn = e.target.closest('button, .qty-btn, .section-btn, .filter-pill');
    if(btn) removePressed(btn);
  });
  document.addEventListener('pointercancel', e => {
    const btn = e.target.closest('button, .qty-btn, .section-btn, .filter-pill');
    if(btn) removePressed(btn);
  });
})();

// attach modal qty buttons reliably
(function(){
  function attachDetailQty(){
    const minus = $('detailQtyMinus');
    const plus = $('detailQtyPlus');
    const inp = $('detailQtyInput');
    if(minus) minus.addEventListener('click', ()=> { updateDetailQty(-1); });
    if(plus) plus.addEventListener('click', ()=> { updateDetailQty(1); });
    if(inp) inp.addEventListener('input', ()=> setDetailQtyFromInput(inp.value));
  }
  // try to attach now and also after DOM ready
  attachDetailQty();
  window.addEventListener('DOMContentLoaded', attachDetailQty);
})();

// Modal backdrop click and ESC to close
window.addEventListener('load', ()=>{
  const dm = $('detailModal');
  if(!dm) return;
  dm.addEventListener('click', (e)=>{ if(e.target === dm) closeDetail(); });
  document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeDetail(); });
});

// Fabric Lightbox backdrop click and ESC to close
window.addEventListener('load', ()=>{
  const lb = $('fabricLightbox');
  if(!lb) return;
  lb.addEventListener('click', (e)=>{ if(e.target === lb) closeFabricLightbox(); });
  document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeFabricLightbox(); });
});

// Open WhatsApp support
function openSupport() {
  const msg = "Ol√°! Gostaria de tirar d√∫vidas sobre os produtos e pedidos.";
  window.open(`https://wa.me/${PHONE_NUMBER}?text=${encodeURIComponent(msg)}`, '_blank');
}
</script>

</body>
</html>